<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>夜莺钱包</title>
    <base href="../" />
    <link rel="stylesheet" href="css/common.css" />
    <link rel="stylesheet" href="css/mnemonic.css" />
    <link rel="stylesheet" href="css/settings.css" />
    <link rel="stylesheet" href="css/transaction.css" />
    <link rel="stylesheet" href="css/wallet.css" />
    <link rel="stylesheet" href="css/accounts.css" />
    <link rel="stylesheet" href="css/network.css" />
    <link rel="stylesheet" href="css/contacts.css" />
  </head>

  <body>
    <div class="container">
      <!-- 添加加载页面，默认显示 -->
      <div id="loadingPage" class="page">
        <div class="loading-container">
          <div class="loading-spinner"></div>
          <p>加载中...</p>
        </div>
      </div>

      <!-- 欢迎页面 -->
      <div id="welcomePage" class="page hidden">
        <h2>夜莺钱包</h2>
        <button id="welcomeCreateWalletBtn" class="btn btn-primary">
          新建钱包
        </button>
        <button id="welcomeImportWalletBtn" class="btn btn-secondary">
          导入钱包
        </button>
      </div>

      <!-- 主钱包页面 -->
      <div id="walletPage" class="page hidden">
        <!-- Header 区域 -->
        <div class="wallet-header">
          <!-- 账户选择器 -->
          <div class="account-selector" id="accountHeader">
            <div class="account-avatar" id="walletAvatar"></div>
            <div class="account-info">
              <div class="account-name">
                <span id="accountName" class="account-name-text">主账户</span>
                <button
                  id="backupSyncStatusBadge"
                  class="sync-status-badge"
                  type="button"
                  title="同步状态"
                  aria-label="同步状态"
                >
                  <svg
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M21 12a9 9 0 0 1-9 9"></path>
                    <path d="M3 12a9 9 0 0 1 9-9"></path>
                    <path d="M21 3v6h-6"></path>
                    <path d="M3 21v-6h6"></path>
                  </svg>
                </button>
              </div>
            </div>
            <button
              class="dropdown-arrow"
              id="accountDropdownBtn"
              type="button"
              aria-label="账户管理"
            >
              ▼
            </button>
          </div>

          <!-- 操作按钮组 -->
          <div class="header-actions">
            <button class="header-icon-btn" id="transferBtn" title="转账">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M22 2L11 13"></path>
                <path d="M22 2L15 22l-4-9-9-4 20-7z"></path>
              </svg>
            </button>
            <button class="header-icon-btn" id="contactsBtn" title="联系人">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="12" cy="7" r="4"></circle>
                <path d="M5.5 21a6.5 6.5 0 0 1 13 0"></path>
              </svg>
            </button>
            <button class="header-icon-btn" id="sitesManageBtn" title="网站管理">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M2 12h20"></path>
                <path d="M12 2a15 15 0 0 1 0 20"></path>
                <path d="M12 2a15 15 0 0 0 0 20"></path>
              </svg>
            </button>
            <button class="header-icon-btn" id="networkManageBtn" title="网络管理">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M19.4 15a1.7 1.7 0 0 0 .3 1.8l.1.1a2 2 0 1 1-2.8 2.8l-.1-.1a1.7 1.7 0 0 0-1.8-.3 1.7 1.7 0 0 0-1 1.5V22a2 2 0 0 1-4 0v-.2a1.7 1.7 0 0 0-1-1.5 1.7 1.7 0 0 0-1.8.3l-.1.1a2 2 0 1 1-2.8-2.8l.1-.1a1.7 1.7 0 0 0 .3-1.8 1.7 1.7 0 0 0-1.5-1H2a2 2 0 0 1 0-4h.2a1.7 1.7 0 0 0 1.5-1 1.7 1.7 0 0 0-.3-1.8l-.1-.1a2 2 0 1 1 2.8-2.8l.1.1a1.7 1.7 0 0 0 1.8.3 1.7 1.7 0 0 0 1-1.5V2a2 2 0 0 1 4 0v.2a1.7 1.7 0 0 0 1 1.5 1.7 1.7 0 0 0 1.8-.3l.1-.1a2 2 0 1 1 2.8 2.8l-.1.1a1.7 1.7 0 0 0-.3 1.8 1.7 1.7 0 0 0 1.5 1H22a2 2 0 0 1 0 4h-.2a1.7 1.7 0 0 0-1.4 1z"></path>
              </svg>
            </button>
            <button class="header-icon-btn" id="settingsBtn" title="设置">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="12" cy="12" r="3"></circle>
                <path
                  d="M12 1v6m0 6v6m5.2-13.2l-4.2 4.2m-2 2l-4.2 4.2m13.2-5.2l-6 0m-6 0l-6 0m13.2 5.2l-4.2-4.2m-2-2l-4.2-4.2"
                ></path>
              </svg>
            </button>
          </div>
        </div>

        <!-- 标签页 -->
        <div class="tabs">
          <button class="tab active" id="tokensTab">通证</button>
          <button class="tab" id="collectiblesTab">藏品</button>
          <button class="tab" id="activityTab">活动</button>
        </div>

        <!-- 通证内容 -->
        <div id="tokensContent" class="tab-content">
          <div class="tab-toolbar">
            <div class="network-selector">
              <div class="network-dot"></div>
              <button type="button" class="network-trigger" aria-haspopup="listbox" aria-expanded="false">
                <span class="network-label"></span>
                <span class="network-chevron">▾</span>
              </button>
              <div class="network-menu hidden" role="listbox"></div>
            </div>
            <div class="tab-toolbar-actions">
              <button id="tokenAddBtn" class="btn btn-icon" aria-label="添加通证" title="添加通证">
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M12 5v14"></path>
                  <path d="M5 12h14"></path>
                </svg>
              </button>
            </div>
          </div>
          <div id="tokenList" class="token-list">
            <div class="empty-state">
              <p>🪙</p>
              <p>暂无通证</p>
            </div>
          </div>
        </div>

        <!-- 藏品内容 -->
        <div id="collectiblesContent" class="tab-content hidden">
          <div class="tab-toolbar">
            <div class="network-selector">
              <div class="network-dot"></div>
              <button type="button" class="network-trigger" aria-haspopup="listbox" aria-expanded="false">
                <span class="network-label"></span>
                <span class="network-chevron">▾</span>
              </button>
              <div class="network-menu hidden" role="listbox"></div>
            </div>
            <div class="tab-toolbar-actions"></div>
          </div>
          <div id="collectiblesList" class="collectibles-list">
            <div class="empty-state">
              <p>🎁</p>
              <p>暂无藏品</p>
            </div>
          </div>
        </div>

        <!-- 活动内容 -->
        <div id="activityContent" class="tab-content hidden">
          <div class="tab-toolbar">
            <div class="network-selector">
              <div class="network-dot"></div>
              <button type="button" class="network-trigger" aria-haspopup="listbox" aria-expanded="false">
                <span class="network-label"></span>
                <span class="network-chevron">▾</span>
              </button>
              <div class="network-menu hidden" role="listbox"></div>
            </div>
            <div class="tab-toolbar-actions">
              <button id="clearTransactionsBtn" class="btn btn-icon" aria-label="清除交易记录" title="清除交易记录">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M3 6h18"></path>
                  <path d="M8 6V4h8v2"></path>
                  <path d="M6 6l1 14a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2l1-14"></path>
                  <path d="M10 11v6"></path>
                  <path d="M14 11v6"></path>
                </svg>
              </button>
            </div>
          </div>
          <div id="transactionList" class="transaction-list">
            <div class="empty-state">
              <p>📭</p>
              <p>暂无交易记录</p>
            </div>
          </div>
        </div>

      </div>

      <!-- 交易详情页面 -->
      <div id="transactionDetailPage" class="page hidden">
        <div class="page-header">
          <button class="back-btn">←</button>
          <h2>交易详情</h2>
        </div>
        <div class="transaction-detail-body">
          <div class="transaction-detail-card">
            <div class="detail-row" id="txDetailStatusRow">
              <div class="detail-label">状态</div>
              <div class="detail-value tx-status pending" id="txDetailStatus">待确认</div>
            </div>
            <div class="detail-row" id="txDetailHashRow">
              <div class="detail-label">交易哈希</div>
              <div class="detail-value-row">
                <div class="detail-value mono" id="txDetailHash"></div>
                <button type="button" class="detail-copy-icon" id="txDetailCopyHash" aria-label="复制交易哈希">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="9" y="9" width="13" height="13" rx="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                  </svg>
                </button>
              </div>
            </div>
            <div class="detail-row" id="txDetailFromRow">
              <div class="detail-label">发送地址</div>
              <div class="detail-value-row">
                <div class="detail-value mono" id="txDetailFrom"></div>
                <button type="button" class="detail-copy-icon" id="txDetailCopyFrom" aria-label="复制发送地址">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="9" y="9" width="13" height="13" rx="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                  </svg>
                </button>
              </div>
            </div>
            <div class="detail-row" id="txDetailToRow">
              <div class="detail-label">接收地址</div>
              <div class="detail-value-row">
                <div class="detail-value mono" id="txDetailTo"></div>
                <button type="button" class="detail-copy-icon" id="txDetailCopyTo" aria-label="复制接收地址">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="9" y="9" width="13" height="13" rx="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                  </svg>
                </button>
              </div>
            </div>
            <div class="detail-row" id="txDetailValueRow">
              <div class="detail-label">金额</div>
              <div class="detail-value" id="txDetailValue"></div>
            </div>
            <div class="detail-row" id="txDetailTimeRow">
              <div class="detail-label">发起时间</div>
              <div class="detail-value" id="txDetailTime"></div>
            </div>
            <div class="detail-row" id="txDetailNetworkRow">
              <div class="detail-label">网络</div>
              <div class="detail-value" id="txDetailNetwork"></div>
            </div>
            <div class="detail-row hidden" id="txDetailConfirmedRow">
              <div class="detail-label">确认时间</div>
              <div class="detail-value" id="txDetailConfirmedTime"></div>
            </div>
            <div class="detail-row hidden" id="txDetailBlockRow">
              <div class="detail-label">区块高度</div>
              <div class="detail-value" id="txDetailBlock"></div>
            </div>
            <div class="detail-row hidden" id="txDetailChainRow">
              <div class="detail-label">链 ID</div>
              <div class="detail-value" id="txDetailChain"></div>
            </div>
            <div class="detail-row hidden" id="txDetailExplorerRow">
              <div class="detail-label">浏览器</div>
              <div class="detail-value">
                <a id="txDetailExplorerLink" class="detail-link" target="_blank" rel="noreferrer">查看交易</a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 转账页面 -->
      <div id="transferPage" class="page hidden">
        <div class="page-header">
          <button class="back-btn">←</button>
          <h2>转账</h2>
        </div>
        <div class="transfer-body">
          <div class="form-group">
            <label>网络</label>
            <div class="network-selector input-like">
              <div class="network-dot"></div>
              <button type="button" class="network-trigger" aria-haspopup="listbox" aria-expanded="false">
                <span class="network-label"></span>
                <span class="network-chevron">▾</span>
              </button>
              <div class="network-menu hidden" role="listbox"></div>
            </div>
          </div>
          <div class="form-group">
            <label>通证</label>
            <div class="token-selector input-like">
              <button type="button" class="token-trigger" aria-haspopup="listbox" aria-expanded="false">
                <span class="token-label">原生代币</span>
                <span class="token-chevron">▾</span>
              </button>
              <div class="token-menu hidden" role="listbox"></div>
            </div>
          </div>
          <div class="form-group">
            <label>发送地址</label>
            <input
              type="text"
              id="senderAddress"
              placeholder="0x..."
              class="input"
              readonly
            />
          </div>
          <div class="form-group">
            <label>接收地址</label>
            <div class="contact-selector">
              <input
                type="text"
                id="recipientAddress"
                class="input contact-input-with-menu"
                placeholder="0x..."
              />
              <button
                type="button"
                id="contactSelectorBtn"
                class="contact-trigger-overlay"
                aria-haspopup="listbox"
                aria-expanded="false"
                aria-label="选择联系人"
              >
                <span class="network-chevron">▾</span>
              </button>
              <div id="contactMenu" class="network-menu hidden" role="listbox"></div>
            </div>
          </div>
          <div class="form-group">
            <label>数量 <span id="transferTokenSymbol">(ETH)</span></label>
            <input
              type="number"
              id="amount"
              placeholder="0.0"
              step="0.0001"
              class="input"
            />
            <span id="transferMaxHint" class="form-hint"></span>
          </div>
        </div>
        <div class="transfer-footer">
          <button class="btn btn-primary btn-block" id="sendBtn">发送</button>
        </div>
      </div>

      <!-- 设置密码页面（复用于首次创建和账户管理创建） -->
      <div id="setPasswordPage" class="page hidden">
        <div class="page-header">
          <button id="backFromPasswordBtn" class="back-btn hidden">←</button>
          <h2>夜莺钱包</h2>
        </div>
        <p class="info-text" id="setPasswordHint">请设置一个密码来保护您的钱包</p>

        <!-- 钱包名称输入 -->
        <div class="form-group">
          <label>钱包名称</label>
          <input
            type="text"
            id="setWalletName"
            placeholder="例如：我的主钱包"
            value="主钱包"
          />
        </div>

        <div class="form-group hidden" id="createWalletTypeGroup">
          <label>钱包类型</label>
          <select id="createWalletTypeSelect" class="input">
            <option value="hd">HD Wallet</option>
            <option value="mpc">MPC Wallet</option>
          </select>
        </div>

        <div id="mpcCreateWalletFields" class="hidden">
          <div class="form-group">
            <label>MPC Wallet ID（可选）</label>
            <input
              type="text"
              id="mpcCreateWalletIdInput"
              class="input"
              placeholder="mpc_wallet_01"
            />
          </div>
          <div class="form-group">
            <label>参与者列表（逗号分隔）</label>
            <input
              type="text"
              id="mpcCreateParticipantsInput"
              class="input"
              placeholder="p1,p2,p3"
            />
          </div>
          <div class="form-group">
            <label>门限 (T)</label>
            <input
              type="number"
              id="mpcCreateThresholdInput"
              class="input"
              min="1"
              step="1"
              placeholder="2"
            />
          </div>
          <div class="form-group">
            <label>曲线</label>
            <select id="mpcCreateCurveSelect" class="input">
              <option value="secp256k1">secp256k1</option>
              <option value="ed25519">ed25519</option>
            </select>
          </div>
          <p class="settings-hint">创建后将自动生成 Keygen 会话，可在 MPC 设置中加入会话。</p>
        </div>

        <div class="form-group">
          <label id="setPasswordLabel">密码</label>
          <input type="password" id="newPassword" placeholder="至少8位字符" />
        </div>

        <div class="form-group" id="confirmPasswordGroup">
          <label id="confirmPasswordLabel">确认密码</label>
          <input
            type="password"
            id="confirmPassword"
            placeholder="再次输入密码"
          />
        </div>

        <button id="setPasswordBtn" class="btn btn-primary">创建钱包</button>
        <button id="cancelPasswordBtn" class="btn btn-secondary">取消</button>
        <p class="settings-hint hidden" id="mpcCreateWalletResult">-</p>
      </div>

      <!-- 添加解锁页面 -->
      <div id="unlockPage" class="page hidden">
        <h2>解锁钱包</h2>
        <p class="info-text">会话已过期，请输入密码解锁</p>
        <div id="unlockReason" class="unlock-reason hidden">
          <div class="unlock-reason-title">触发来源</div>
          <div class="unlock-reason-row">
            <span class="unlock-reason-label">网站</span>
            <span class="unlock-reason-value" id="unlockReasonOrigin">-</span>
          </div>
          <div class="unlock-reason-row">
            <span class="unlock-reason-label">请求</span>
            <span class="unlock-reason-value" id="unlockReasonMethod">-</span>
          </div>
          <div class="unlock-reason-row">
            <span class="unlock-reason-label">时间</span>
            <span class="unlock-reason-value" id="unlockReasonTime">-</span>
          </div>
        </div>
        <div class="form-group">
          <label>密码:</label>
          <input type="password" id="unlockPassword" placeholder="输入密码" />
        </div>
        <button id="unlockBtn" class="btn btn-primary">解锁</button>
      </div>

      <!-- 导入钱包页面（复用于首次导入和账户管理导入） -->
      <div id="importPage" class="page hidden">
        <div class="page-header">
          <button id="backFromImportBtn" class="back-btn">←</button>
          <h2>导入钱包</h2>
        </div>

        <!-- 导入类型切换 -->
        <div class="import-tabs">
          <button class="import-tab active" data-type="mnemonic">助记词</button>
          <button class="import-tab" data-type="privateKey">私钥</button>
        </div>

        <!-- 钱包名称 -->
        <div class="form-group">
          <label>钱包名称</label>
          <input
            type="text"
            id="importAccountName"
            placeholder="例如：导入的钱包"
          />
        </div>

        <!-- 助记词导入 -->
        <div id="mnemonicImportSection">
          <div class="form-group">
            <label>助记词</label>
            <textarea
              id="importMnemonic"
              rows="3"
              placeholder="输入12个助记词，用空格分隔"
            ></textarea>
          </div>
        </div>

        <!-- 私钥导入 -->
        <div id="privateKeyImportSection" class="hidden">
          <div class="form-group">
            <label>私钥</label>
            <input
              type="password"
              id="importPrivateKey"
              placeholder="输入私钥（0x开头）"
            />
          </div>
        </div>

        <!-- 密码 -->
        <div class="form-group">
          <label id="importPasswordLabel">密码</label>
          <input
            type="password"
            id="importWalletPassword"
            placeholder="至少8位字符"
          />
        </div>

        <button id="importBtn" class="btn btn-primary">导入钱包</button>
        <button id="cancelImportBtn" class="btn btn-secondary">取消</button>
      </div>

      <!-- 账户管理页面 -->
      <div id="accountsPage" class="page hidden">
        <div class="page-header">
          <button class="back-btn">←</button>
          <h2>账户管理</h2>
        </div>

        <div class="account-manage-container">
          <!-- 钱包列表区域（可滚动） -->
          <div class="wallet-list-wrapper">
            <div id="walletList" class="wallet-list">
              <!-- 钱包列表将在这里动态渲染 -->
            </div>
          </div>

          <!-- 底部操作按钮（固定） -->
          <div class="account-actions-footer">
            <button class="btn btn-primary" id="accountsCreateWalletBtn">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M20 7h-3a2 2 0 0 1-2-2V2"></path>
                <path
                  d="M9 18a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h7l4 4v10a2 2 0 0 1-2 2Z"
                ></path>
                <path d="M3 7.6v12.8A1.6 1.6 0 0 0 4.6 22h9.8"></path>
              </svg>
              创建钱包
            </button>
            <button class="btn btn-secondary" id="accountsImportWalletBtn">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
              导入钱包
            </button>
          </div>
        </div>
      </div>

      <!-- 网络管理页面 -->
      <div id="networkManagePage" class="page hidden">
        <div class="page-header">
          <button class="back-btn">←</button>
          <h2>网络管理</h2>
          <div class="page-actions">
            <button id="networkAddBtn" class="btn btn-primary btn-small">
              新增网络
            </button>
            <div class="page-menu">
              <button id="networkMenuBtn" class="btn btn-secondary btn-small btn-icon" aria-haspopup="menu" aria-expanded="false" title="更多">
                ⋯
              </button>
              <div id="networkMenu" class="network-menu hidden" role="menu">
                <button type="button" class="network-option" data-action="import">导入 JSON</button>
                <button type="button" class="network-option" data-action="export">导出 JSON</button>
              </div>
            </div>
            <input
              type="file"
              id="networkImportInput"
              class="hidden"
              accept="application/json"
            />
          </div>
        </div>

        <div class="network-list" id="networkManageList"></div>
      </div>

      <!-- 网络新增/编辑页面 -->
      <div id="networkFormPage" class="page hidden">
        <div class="page-header">
          <button class="back-btn">←</button>
          <h2 id="networkFormPageTitle">新增网络</h2>
        </div>

        <input type="hidden" id="networkEditChainId" value="" />
        <div class="network-form">
          <div class="form-group">
            <label>网络名称</label>
            <input
              type="text"
              id="networkNameInput"
              class="input"
              placeholder="例如：MyChain"
            />
          </div>

          <div class="form-group">
            <label>RPC URL</label>
            <input
              type="text"
              id="networkRpcInput"
              class="input"
              placeholder="https://..."
            />
          </div>

          <div class="form-group">
            <label>Chain ID</label>
            <input
              type="text"
              id="networkChainIdInput"
              class="input"
              placeholder="例如：0x1 或 1"
            />
          </div>

          <div class="form-group">
            <label>货币符号</label>
            <input
              type="text"
              id="networkSymbolInput"
              class="input"
              placeholder="例如：ETH"
            />
          </div>

          <div class="form-group">
            <label>区块浏览器（可选）</label>
            <input
              type="text"
              id="networkExplorerInput"
              class="input"
              placeholder="https://explorer.example.com"
            />
          </div>

          <div class="network-form-actions">
            <button id="saveNetworkBtn" class="btn btn-primary">
              添加网络
            </button>
            <button id="cancelNetworkBtn" class="btn btn-secondary">
              取消
            </button>
          </div>
        </div>
      </div>

      <!-- 添加通证页面 -->
      <div id="tokenAddPage" class="page hidden">
        <div class="page-header">
          <button class="back-btn">←</button>
          <h2>添加通证</h2>
        </div>

        <div class="form-group">
          <label>网络</label>
          <div class="network-selector input-like">
            <div class="network-dot"></div>
            <button type="button" class="network-trigger" aria-haspopup="listbox" aria-expanded="false">
                <span class="network-label"></span>
              <span class="network-chevron">▾</span>
            </button>
            <div class="network-menu hidden" role="listbox"></div>
          </div>
        </div>

        <div class="token-form">
          <div class="form-group">
            <label>合约地址</label>
            <input
              type="text"
              id="tokenAddressInput"
              class="input"
              placeholder="0x..."
            />
          </div>

          <div class="form-group">
            <label>通证符号</label>
            <input
              type="text"
              id="tokenSymbolInput"
              class="input"
              placeholder="例如：USDT"
            />
          </div>

          <div class="form-group">
            <label>小数位（可选）</label>
            <input
              type="number"
              id="tokenDecimalsInput"
              class="input"
              placeholder="18"
              min="0"
              max="18"
            />
          </div>

          <div class="form-group">
            <label>通证名称（可选）</label>
            <input
              type="text"
              id="tokenNameInput"
              class="input"
              placeholder="例如：Tether USD"
            />
          </div>

          <div class="token-form-actions">
            <button id="saveTokenBtn" class="btn btn-primary">
              添加通证
            </button>
            <button id="cancelTokenBtn" class="btn btn-secondary">
              取消
            </button>
          </div>
        </div>
      </div>

      <!-- 账户详情页面 -->
      <div id="accountDetailPage" class="page hidden">
        <div class="page-header">
          <button class="back-btn">←</button>
          <h2>账户详情</h2>
        </div>

        <div class="account-detail-card">
          <div class="account-detail-avatar" id="accountDetailAvatar"></div>
          <div class="account-detail-name-row" id="accountDetailNameRow">
            <div class="account-detail-name" id="accountDetailNameText" title="点击修改"></div>
            <button class="detail-icon-btn" id="editAccountNameBtn" title="编辑名称" aria-label="编辑名称">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 20h9"></path>
                <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"></path>
              </svg>
            </button>
          </div>
          <div class="account-detail-name-edit hidden" id="accountDetailNameEdit">
            <input
              id="accountDetailNameInput"
              class="input"
              type="text"
              maxlength="20"
              placeholder="输入账户名称"
            />
            <div class="account-detail-name-actions">
              <button id="saveAccountNameBtn" class="btn btn-primary btn-small">保存</button>
              <button id="cancelAccountNameBtn" class="btn btn-secondary btn-small">取消</button>
            </div>
          </div>
          <div class="account-detail-address-row">
            <div class="account-detail-address" id="accountDetailAddress" title="点击复制地址"></div>
            <button class="detail-icon-btn" id="copyAccountAddressBtn" title="复制地址" aria-label="复制地址">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
            </button>
          </div>
          <div class="account-detail-type" id="accountDetailType"></div>
        </div>

        <div class="account-detail-qr-actions">
          <div class="account-detail-qr-size">
            <label for="accountDetailQrSize">二维码大小</label>
            <select id="accountDetailQrSize" class="input">
              <option value="120">小</option>
              <option value="160" selected>中</option>
              <option value="200">大</option>
              <option value="240">特大</option>
            </select>
          </div>
          <button id="exportAccountQrBtn" class="btn btn-secondary btn-small">
            导出二维码
          </button>
        </div>
        <div class="account-detail-qr">
          <div id="accountDetailQr"></div>
        </div>
      </div>

      <!-- 设置页面 -->
      <div id="settingsPage" class="page hidden">
        <div class="page-header">
          <button id="settingsBackBtn" class="back-btn">←</button>
          <h2>设置</h2>
        </div>

        <div class="settings-body">
          <!-- 安全设置 -->
          <div class="settings-section">
            <h3>🔐 安全设置</h3>
            <button id="changePasswordBtn" class="btn btn-primary">
              修改密码
            </button>

            <div class="settings-divider"></div>

            <button id="resetWalletBtn" class="btn btn-danger">重置钱包</button>
            <p style="font-size: 12px; color: #999; margin-top: 8px">
              ⚠️ 重置后将清除所有数据，请确保已备份私钥
            </p>
          </div>

          <!-- 备份与同步 -->
          <div class="settings-section" id="backupSyncSection">
            <h3>☁️ 备份与同步</h3>
            <div class="settings-row">
              <label class="settings-toggle">
                <input type="checkbox" id="backupSyncEnabledToggle" />
                <span>启用备份与同步</span>
              </label>
            </div>
            <div class="form-group">
              <label>WebDAV 地址</label>
              <input
                type="url"
                id="backupSyncEndpointInput"
                placeholder="https://webdav.yeying.pub"
              />
            </div>
            <div class="form-group">
              <label>认证方式</label>
              <select id="backupSyncAuthModeSelect" class="input">
                <option value="siwe">SIWE (钱包签名)</option>
                <option value="ucan">UCAN</option>
                <option value="basic">Basic</option>
              </select>
            </div>

            <div id="backupSyncSiwePanel" class="sync-auth-panel">
              <div class="form-group">
                <label>当前地址</label>
                <div class="sync-address" id="backupSyncAccountAddress">-</div>
              </div>
              <div class="settings-row">
                <button id="backupSyncSiweLoginBtn" class="btn btn-primary btn-small">SIWE 登录</button>
                <button id="backupSyncSiweRefreshBtn" class="btn btn-secondary btn-small">刷新 Token</button>
              </div>
              <p class="settings-hint" id="backupSyncTokenStatus">未登录</p>
            </div>

            <div id="backupSyncUcanPanel" class="sync-auth-panel hidden">
              <div class="form-group">
                <label>Audience (did:web)</label>
                <input
                  type="text"
                  id="backupSyncUcanAudienceInput"
                  placeholder="did:web:webdav.yeying.pub"
                />
              </div>
              <div class="form-group">
                <label>Capability Resource</label>
                <input
                  type="text"
                  id="backupSyncUcanResourceInput"
                  placeholder="app:<extension-id>"
                />
              </div>
              <div class="form-group">
                <label>Capability Action</label>
                <input
                  type="text"
                  id="backupSyncUcanActionInput"
                  placeholder="write"
                />
              </div>
              <div class="form-group">
                <label>有效期 (小时)</label>
                <input
                  type="number"
                  id="backupSyncUcanTtlInput"
                  min="1"
                  max="168"
                  step="1"
                  value="24"
                />
              </div>
              <div class="settings-row">
                <button id="backupSyncUcanGenerateBtn" class="btn btn-secondary btn-small">生成 UCAN</button>
              </div>
            </div>

            <div id="backupSyncBasicPanel" class="sync-auth-panel hidden">
              <div class="form-group">
                <label>Basic 凭证</label>
                <input
                  type="text"
                  id="backupSyncBasicInput"
                  placeholder="username:password 或 Basic base64"
                />
              </div>
              <button id="backupSyncBasicSaveBtn" class="btn btn-primary btn-small">保存凭证</button>
            </div>

            <div class="settings-divider"></div>

            <div class="settings-row">
              <button id="backupSyncNowBtn" class="btn btn-secondary">立即同步</button>
              <button id="backupSyncClearRemoteBtn" class="btn btn-danger btn-small">清除远端备份</button>
            </div>
            <p class="settings-hint" id="backupSyncLastStatus">最近拉取: - · 最近推送: -</p>

            <div class="settings-divider"></div>
            <h4 class="sync-conflict-title">同步冲突</h4>
            <div id="backupSyncDebugRow" class="settings-row hidden">
              <button id="backupSyncSimulateConflictBtn" class="btn btn-secondary btn-small">模拟冲突</button>
            </div>
            <div id="backupSyncConflictsList" class="sync-conflicts-list">
              <div class="empty-message">暂无冲突</div>
            </div>
          </div>

          <!-- 日志审计 -->
          <div class="settings-section" id="backupSyncAuditSection">
            <h3>🔎 日志审计</h3>
            <div class="settings-row">
              <button id="backupSyncAuditBtn" class="btn btn-secondary">进入日志审计</button>
            </div>
            <p class="settings-hint">查看同步日志，支持搜索与翻页</p>
          </div>

          <!-- MPC 门限钱包设置 -->
          <div class="settings-section" id="mpcSettingsSection">
            <h3>🧩 MPC 门限钱包</h3>
            <div class="form-group">
              <label>协调器鉴权</label>
              <select id="mpcAuthSchemeSelect" class="input">
                <option value="ucan">UCAN</option>
              </select>
            </div>
            <div class="form-group">
              <label>端到端加密套件</label>
              <select id="mpcE2eSuiteSelect" class="input">
                <option value="x25519-aes-gcm">x25519-aes-gcm</option>
              </select>
            </div>
            <div class="form-group">
              <label>Key Refresh 触发策略</label>
              <select id="mpcRefreshPolicySelect" class="input">
                <option value="manual">手动</option>
              </select>
            </div>
            <p class="settings-hint">这些配置用于 MPC 协调器与成员端协作。</p>
          </div>

          <!-- MPC 协调器配置 -->
          <div class="settings-section" id="mpcCoordinatorSection">
            <h3>🛰️ MPC 协调器</h3>
            <div class="form-group">
              <label>协调器地址</label>
              <input
                type="text"
                id="mpcCoordinatorEndpointInput"
                class="input"
                placeholder="https://www.yeying.pub"
              />
            </div>
            <div class="form-group">
              <label>UCAN Resource</label>
              <input
                type="text"
                id="mpcCoordinatorUcanResourceInput"
                class="input"
                placeholder="app:your-app"
              />
            </div>
            <div class="form-group">
              <label>UCAN Action</label>
              <input
                type="text"
                id="mpcCoordinatorUcanActionInput"
                class="input"
                placeholder="coordinate"
              />
            </div>
            <div class="form-group">
              <label>UCAN Audience</label>
              <input
                type="text"
                id="mpcCoordinatorUcanAudienceInput"
                class="input"
                placeholder="did:web:example.com"
              />
            </div>
            <div class="form-group">
              <label>UCAN 有效期 (小时)</label>
              <input
                type="number"
                id="mpcCoordinatorUcanTtlInput"
                class="input"
                min="1"
                max="168"
                step="1"
                value="24"
              />
            </div>
            <div class="form-group">
              <label>UCAN Token（可选）</label>
              <textarea
                id="mpcCoordinatorUcanTokenInput"
                class="input"
                placeholder="粘贴 UCAN Token"
              ></textarea>
            </div>
            <div class="settings-row">
              <button id="mpcCoordinatorSaveBtn" class="btn btn-secondary btn-small">保存配置</button>
              <button id="mpcCoordinatorUcanGenerateBtn" class="btn btn-secondary btn-small">生成 UCAN</button>
            </div>
            <p class="settings-hint">配置用于协调器鉴权与会话创建/加入。</p>
          </div>

          <!-- MPC 会话操作 -->
          <div class="settings-section" id="mpcKeygenSection">
            <h3>🔐 MPC 会话</h3>
            <h4>加入会话</h4>
            <div class="form-group">
              <label>Session ID</label>
              <input
                type="text"
                id="mpcJoinSessionIdInput"
                class="input"
                placeholder="sess_..."
              />
            </div>
            <div class="form-group">
              <label>Participant ID</label>
              <input
                type="text"
                id="mpcJoinParticipantIdInput"
                class="input"
                placeholder="p1"
              />
            </div>
            <div class="form-group">
              <label>身份 (DID)</label>
              <input
                type="text"
                id="mpcJoinIdentityInput"
                class="input"
                placeholder="did:pkh:eth:0x..."
              />
            </div>
            <div class="settings-row">
              <button id="mpcJoinSessionBtn" class="btn btn-secondary btn-small">加入会话并监听</button>
              <button id="mpcStopStreamBtn" class="btn btn-secondary btn-small">停止监听</button>
            </div>
            <p class="settings-hint" id="mpcJoinSessionResult">-</p>

            <div class="settings-divider"></div>
            <h4>发送消息</h4>
            <div class="form-group">
              <label>Session ID</label>
              <input
                type="text"
                id="mpcSendSessionIdInput"
                class="input"
                placeholder="sess_..."
              />
            </div>
            <div class="form-group">
              <label>From (Participant ID)</label>
              <input
                type="text"
                id="mpcSendFromInput"
                class="input"
                placeholder="p1"
              />
            </div>
            <div class="form-group">
              <label>To (Participant ID, 可选)</label>
              <input
                type="text"
                id="mpcSendToInput"
                class="input"
                placeholder="p2"
              />
            </div>
            <div class="form-group">
              <label>Recipient E2E 公钥（可选）</label>
              <input
                type="text"
                id="mpcSendRecipientKeyInput"
                class="input"
                placeholder="x25519:base64..."
              />
            </div>
            <div class="form-group">
              <label>消息类型</label>
              <input
                type="text"
                id="mpcSendTypeInput"
                class="input"
                placeholder="keygen_round_1"
              />
            </div>
            <div class="form-group">
              <label>Round</label>
              <input
                type="number"
                id="mpcSendRoundInput"
                class="input"
                min="0"
                step="1"
                placeholder="1"
              />
            </div>
            <div class="form-group">
              <label>Seq</label>
              <input
                type="number"
                id="mpcSendSeqInput"
                class="input"
                min="0"
                step="1"
                placeholder="1"
              />
            </div>
            <div class="form-group">
              <label>Payload (JSON)</label>
              <textarea
                id="mpcSendPayloadInput"
                class="input"
                placeholder="{\"step\":1}"
              ></textarea>
            </div>
            <div class="settings-row">
              <button id="mpcSendMessageBtn" class="btn btn-primary btn-small">发送消息</button>
            </div>
            <p class="settings-hint" id="mpcSendMessageResult">-</p>

            <div class="settings-divider"></div>
            <h4>消息收件箱</h4>
            <div class="settings-row">
              <button id="mpcMessagesPollStartBtn" class="btn btn-secondary btn-small">开始轮询</button>
              <button id="mpcMessagesPollStopBtn" class="btn btn-secondary btn-small">停止轮询</button>
            </div>
            <p class="settings-hint" id="mpcMessagesPollStatus">未开始轮询</p>
            <div id="mpcMessagesList" class="sync-activity-list sync-log-list">
              <div class="empty-message">暂无消息</div>
            </div>
            <div class="settings-divider"></div>
            <h4>消息详情</h4>
            <p class="settings-hint" id="mpcMessageDetailStatus">-</p>
            <textarea id="mpcMessageDetailPayload" class="input" readonly placeholder="解密后的 payload 会显示在这里"></textarea>
          </div>

          <!-- MPC 会话列表 -->
          <div class="settings-section" id="mpcSessionsSection">
            <h3>🗂️ MPC 会话列表</h3>
            <div class="settings-row">
              <button id="mpcSessionsRefreshBtn" class="btn btn-secondary btn-small">刷新列表</button>
            </div>
            <div id="mpcSessionsList" class="sync-activity-list">
              <div class="empty-message">暂无会话</div>
            </div>
          </div>

          <!-- MPC 日志审计 -->
          <div class="settings-section" id="mpcAuditSection">
            <h3>📒 MPC 日志审计</h3>
            <div class="settings-row">
              <button id="mpcAuditBtn" class="btn btn-secondary">进入 MPC 日志审计</button>
            </div>
            <p class="settings-hint">查看 MPC 协调器事件日志</p>
          </div>
        </div>
      </div>

      <!-- 同步日志审计页面 -->
      <div id="backupSyncLogsPage" class="page hidden">
        <div class="page-header">
          <button class="back-btn">←</button>
          <h2>日志审计</h2>
          <div class="page-actions">
            <button id="backupSyncClearLogsBtn" class="btn btn-secondary btn-small">
              清空日志
            </button>
          </div>
        </div>
        <div class="sync-log-toolbar">
          <input
            type="text"
            id="backupSyncLogsSearchInput"
            class="input"
            placeholder="搜索日志（关键字/动作/原因）"
          />
        </div>
        <div class="sync-log-config">
          <div class="form-group">
            <label>最大保留条数</label>
            <input
              type="number"
              id="backupSyncLogMaxInput"
              class="input"
              min="50"
              max="100000"
              step="50"
              placeholder="100000"
            />
          </div>
          <div class="form-group">
            <label>保留天数</label>
            <input
              type="number"
              id="backupSyncLogRetentionInput"
              class="input"
              min="1"
              max="365"
              step="1"
              placeholder="30"
            />
          </div>
        </div>
        <div class="settings-row sync-log-config-actions">
          <button id="backupSyncLogRetentionSaveBtn" class="btn btn-secondary btn-small">
            保存留存策略
          </button>
        </div>
        <div class="sync-log-summary">
          <div class="sync-log-metric">
            <div class="sync-log-label">最近拉取</div>
            <div class="sync-log-value" id="backupSyncLogsLastPull">-</div>
          </div>
          <div class="sync-log-metric">
            <div class="sync-log-label">最近推送</div>
            <div class="sync-log-value" id="backupSyncLogsLastPush">-</div>
          </div>
          <div class="sync-log-metric">
            <div class="sync-log-label">日志总数</div>
            <div class="sync-log-value" id="backupSyncLogsTotal">0</div>
          </div>
          <div class="sync-log-metric">
            <div class="sync-log-label">匹配结果</div>
            <div class="sync-log-value" id="backupSyncLogsMatch">0</div>
          </div>
        </div>
        <h3 class="sync-log-title">同步日志</h3>
        <div id="backupSyncLogsList" class="sync-activity-list sync-log-list">
          <div class="empty-message">暂无日志</div>
        </div>
        <div id="backupSyncLogsFooter" class="sync-log-footer hidden"></div>
      </div>

      <!-- MPC 日志审计页面 -->
      <div id="mpcLogsPage" class="page hidden">
        <div class="page-header">
          <button class="back-btn">←</button>
          <h2>MPC 日志审计</h2>
          <div class="page-actions">
            <button id="mpcClearLogsBtn" class="btn btn-secondary btn-small">
              清空日志
            </button>
          </div>
        </div>
        <div class="sync-log-toolbar">
          <input
            type="text"
            id="mpcLogsSearchInput"
            class="input"
            placeholder="搜索日志（动作/Session/关键字）"
          />
        </div>
        <div class="sync-log-config">
          <div class="form-group">
            <label>Webhook 地址</label>
            <input
              type="text"
              id="mpcAuditExportEndpointInput"
              class="input"
              placeholder="https://audit.example.com/hooks/mpc"
            />
          </div>
          <div class="form-group">
            <label>启用导出</label>
            <label class="settings-toggle">
              <input type="checkbox" id="mpcAuditExportEnabledToggle" />
              <span>启用</span>
            </label>
          </div>
          <div class="form-group" style="grid-column: span 2;">
            <label>Webhook Headers (JSON)</label>
            <textarea
              id="mpcAuditExportHeadersInput"
              class="input"
              placeholder="{\"Authorization\":\"Bearer <token>\"}"
            ></textarea>
          </div>
        </div>
        <div class="settings-row sync-log-config-actions">
          <button id="mpcAuditExportSaveBtn" class="btn btn-secondary btn-small">
            保存导出配置
          </button>
          <button id="mpcAuditExportFlushBtn" class="btn btn-secondary btn-small">
            推送队列
          </button>
          <button id="mpcAuditExportAllBtn" class="btn btn-secondary btn-small">
            推送全部
          </button>
          <button id="mpcAuditExportJsonBtn" class="btn btn-secondary btn-small">
            导出 JSON
          </button>
          <button id="mpcAuditExportCsvBtn" class="btn btn-secondary btn-small">
            导出 CSV
          </button>
        </div>
        <p class="settings-hint" id="mpcAuditExportStatus">最近推送: -</p>
        <div class="sync-log-summary">
          <div class="sync-log-metric">
            <div class="sync-log-label">最近事件</div>
            <div class="sync-log-value" id="mpcLogsLastEvent">-</div>
          </div>
          <div class="sync-log-metric">
            <div class="sync-log-label">日志总数</div>
            <div class="sync-log-value" id="mpcLogsTotal">0</div>
          </div>
          <div class="sync-log-metric">
            <div class="sync-log-label">匹配结果</div>
            <div class="sync-log-value" id="mpcLogsMatch">0</div>
          </div>
        </div>
        <h3 class="sync-log-title">MPC 日志</h3>
        <div id="mpcLogsList" class="sync-activity-list sync-log-list">
          <div class="empty-message">暂无日志</div>
        </div>
        <div id="mpcLogsFooter" class="sync-log-footer hidden"></div>
      </div>

      <!-- MPC 会话详情 -->
      <div id="mpcSessionDetailModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
          <div class="modal-header">
            <h3>会话详情</h3>
            <button class="btn-close" id="closeMpcSessionDetailModal">✕</button>
          </div>
          <div class="modal-body">
            <div class="detail-row">
              <div class="detail-label">Session ID</div>
              <div class="detail-value mono" id="mpcSessionDetailId">-</div>
            </div>
            <div class="detail-row">
              <div class="detail-label">类型</div>
              <div class="detail-value" id="mpcSessionDetailType">-</div>
            </div>
            <div class="detail-row">
              <div class="detail-label">状态</div>
              <div class="detail-value" id="mpcSessionDetailStatus">-</div>
            </div>
            <div class="detail-row">
              <div class="detail-label">轮次</div>
              <div class="detail-value" id="mpcSessionDetailRound">-</div>
            </div>
            <div class="detail-row">
              <div class="detail-label">门限</div>
              <div class="detail-value" id="mpcSessionDetailThreshold">-</div>
            </div>
            <div class="detail-row">
              <div class="detail-label">曲线</div>
              <div class="detail-value" id="mpcSessionDetailCurve">-</div>
            </div>
            <div class="detail-row">
              <div class="detail-label">成员</div>
              <div class="detail-value" id="mpcSessionDetailParticipants">-</div>
            </div>
          </div>
          <div class="modal-footer">
            <button id="refreshMpcSessionDetailBtn" class="btn btn-secondary">刷新</button>
            <button id="closeMpcSessionDetailBtn" class="btn btn-secondary">关闭</button>
          </div>
        </div>
      </div>

      <!-- 网站管理页面 -->
      <div id="sitesPage" class="page hidden">
        <div class="page-header">
          <button class="back-btn">←</button>
          <h2>网站管理</h2>
          <div class="page-actions">
            <button id="clearAllAuthBtn" class="btn btn-danger btn-small">
              清除所有授权
            </button>
          </div>
        </div>
        <div class="sites-body">
          <div class="sites-search">
            <input
              type="text"
              id="siteSearchInput"
              class="input"
              placeholder="搜索网站（域名或地址）"
            />
          </div>
          <div id="authorizedSitesList">
            <div class="empty-message">正在加载...</div>
          </div>
          <p class="settings-hint">只保留你信任的网站授权。</p>
        </div>
      </div>

      <!-- 网站授权详情 -->
      <div id="siteDetailModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
          <div class="modal-header">
            <h3>授权详情</h3>
            <button class="btn-close" id="closeSiteDetailModal">✕</button>
          </div>
          <div class="modal-body site-detail-body">
            <div class="detail-row">
              <div class="detail-label">网站</div>
              <div class="detail-value" id="siteDetailOrigin"></div>
            </div>
            <div class="detail-row">
              <div class="detail-label">地址</div>
              <div class="detail-value mono" id="siteDetailAddress"></div>
            </div>
            <div class="detail-row">
              <div class="detail-label">授权时间</div>
              <div class="detail-value" id="siteDetailTime"></div>
            </div>
            <div class="site-detail-section-title">UCAN 会话</div>
            <div id="siteDetailUcanEmpty" class="site-detail-empty">暂无 UCAN 会话</div>
            <div id="siteDetailUcanRows" class="site-detail-ucan hidden">
              <div class="detail-row">
                <div class="detail-label">状态</div>
                <div class="detail-value" id="siteDetailUcanStatus"></div>
              </div>
              <div class="detail-row">
                <div class="detail-label">Session</div>
                <div class="detail-value mono" id="siteDetailUcanSession"></div>
              </div>
              <div class="detail-row">
                <div class="detail-label">DID</div>
                <div class="detail-value mono" id="siteDetailUcanDid"></div>
              </div>
              <div class="detail-row">
                <div class="detail-label">创建时间</div>
                <div class="detail-value" id="siteDetailUcanCreated"></div>
              </div>
              <div class="detail-row">
                <div class="detail-label">过期时间</div>
                <div class="detail-value" id="siteDetailUcanExpires"></div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button id="revokeSiteDetailBtn" class="btn btn-danger">撤销授权</button>
            <button id="closeSiteDetailBtn" class="btn btn-secondary">关闭</button>
          </div>
        </div>
      </div>

      <!-- 联系人页面 -->
      <div id="contactsPage" class="page hidden">
        <div class="page-header">
          <button class="back-btn">←</button>
          <h2>联系人</h2>
          <div class="contacts-header-actions">
            <button id="openAddContactBtn" class="btn btn-primary btn-small">添加联系人</button>
            <div class="contacts-menu">
              <button id="contactsMenuBtn" class="btn btn-secondary btn-small btn-icon" aria-haspopup="menu" aria-expanded="false" title="更多">
                ⋯
              </button>
              <div id="contactsMenu" class="network-menu hidden" role="menu">
                <button type="button" class="network-option" data-action="import">导入 JSON</button>
                <button type="button" class="network-option" data-action="export">导出 JSON</button>
              </div>
            </div>
            <input
              type="file"
              id="contactsImportInput"
              class="hidden"
              accept="application/json"
            />
          </div>
        </div>
        <div class="contacts-body">
          <div id="contactsList" class="contacts-list">
            <div class="empty-message">正在加载...</div>
          </div>
        </div>
      </div>

      <!-- 添加/编辑联系人模态框 -->
      <div id="contactEditorModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content contact-editor-modal">
          <div class="modal-header">
            <h3 id="contactModalTitle">添加联系人</h3>
            <button class="btn-close" id="closeContactEditorModal">✕</button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="contactIdInput" />
            <div class="form-group">
              <label>联系人名称</label>
              <input
                type="text"
                id="contactNameInput"
                class="input"
                placeholder="例如：Alice"
              />
            </div>
            <div class="form-group">
              <label>联系人地址</label>
              <input
                type="text"
                id="contactAddressInput"
                class="input"
                placeholder="0x..."
              />
            </div>
            <div class="form-group">
              <label>备注（可选）</label>
              <input
                type="text"
                id="contactNoteInput"
                class="input"
                placeholder="备注信息"
              />
            </div>
          </div>
          <div class="modal-footer">
            <button id="cancelEditContactBtn" class="btn btn-secondary">取消</button>
            <button id="addContactBtn" class="btn btn-primary">添加联系人</button>
          </div>
        </div>
      </div>

      <!-- 修改密码模态框 -->
      <div id="changePasswordModal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
          <div class="modal-header">
            <h3>修改密码</h3>
            <button class="btn-close" id="closeChangePasswordModal">✕</button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label>旧密码</label>
              <input
                type="password"
                id="oldPasswordInput"
                placeholder="输入当前密码"
              />
            </div>
            <div class="form-group">
              <label>新密码</label>
              <input
                type="password"
                id="newPasswordInput"
                placeholder="至少8位字符"
              />
            </div>
            <div class="form-group">
              <label>确认新密码</label>
              <input
                type="password"
                id="confirmNewPasswordInput"
                placeholder="再次输入新密码"
              />
            </div>
          </div>
          <div class="modal-footer">
            <button id="cancelChangePasswordBtn" class="btn btn-secondary">取消</button>
            <button id="confirmChangePasswordBtn" class="btn btn-primary">修改</button>
          </div>
        </div>
      </div>

    </div>

    <!-- 全局悬浮提示 -->
    <div id="globalToast" class="toast hidden"></div>

    <!-- 创建账户模态框 -->
    <div id="createAccountModal" class="modal hidden">
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3>创建新账户</h3>
          <button class="btn-close" id="closeCreateAccountModal">✕</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>账户名称</label>
            <input
              type="text"
              id="newAccountName"
              class="input"
              placeholder="例如：我的账户 2"
            />
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" id="cancelCreateAccount">
            取消
          </button>
          <button class="btn btn-primary" id="confirmCreateAccount">
            创建
          </button>
        </div>
      </div>
    </div>

    <!-- 删除账户模态框 -->
    <div id="deleteAccountModal" class="modal hidden">
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3>删除账户</h3>
          <button class="btn-close" id="closeDeleteAccountModal">✕</button>
        </div>
        <div class="modal-body">
          <div class="warning-box">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"
              ></path>
              <line x1="12" y1="9" x2="12" y2="13"></line>
              <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
            <p>删除账户后将无法恢复，请确保已备份助记词或私钥！</p>
          </div>

          <div class="account-info-box">
            <div class="info-row">
              <span class="label">账户名称：</span>
              <span id="deleteAccountName"></span>
            </div>
            <div class="info-row">
              <span class="label">地址：</span>
              <span id="deleteAccountAddress"></span>
            </div>
          </div>

          <input type="hidden" id="deleteAccountId" />
        </div>
        <div class="modal-footer">
          <!-- ✅ 添加 .btn 类 -->
          <button class="btn btn-secondary" id="cancelDeleteAccount">
            取消
          </button>
          <button class="btn btn-danger" id="confirmDeleteAccount">
            确认删除
          </button>
        </div>
      </div>
    </div>

    <!-- 重置钱包模态框 -->
    <div id="resetWalletModal" class="modal hidden">
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3>重置钱包</h3>
          <button class="btn-close" id="closeResetWalletModal">✕</button>
        </div>
        <div class="modal-body">
          <div class="warning-box">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"
              ></path>
              <line x1="12" y1="9" x2="12" y2="13"></line>
              <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
            <p>重置后将删除所有钱包数据，且无法恢复，请确保已备份私钥。</p>
          </div>
          <div class="form-group">
            <label>确认重置</label>
            <input
              type="text"
              id="resetWalletConfirmInput"
              class="input"
              placeholder='请输入 "RESET"'
              autocomplete="off"
            />
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" id="cancelResetWalletBtn">取消</button>
          <button class="btn btn-danger" id="confirmResetWalletBtn" disabled>确认重置</button>
        </div>
      </div>
    </div>

    <!-- 显示密钥模态框 -->
    <div id="secretDisplayModal" class="modal hidden">
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="secretDisplayTitle">查看密钥</h3>
          <button class="btn-close" id="closeSecretDisplayModal">✕</button>
        </div>
        <div class="modal-body">
          <div class="warning-box">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"
              ></path>
              <line x1="12" y1="9" x2="12" y2="13"></line>
              <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
            <p id="secretDisplayWarning">⚠️ 请勿泄露密钥信息。</p>
          </div>
          <div class="form-group">
            <label id="secretDisplayLabel">内容</label>
            <textarea
              id="secretDisplayValue"
              readonly
              rows="3"
              class="input secret-display-value"
            ></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" id="copySecretDisplayBtn">
            复制
          </button>
          <button class="btn btn-primary" id="confirmSecretDisplayBtn">
            关闭
          </button>
        </div>
      </div>
    </div>


    <!-- 第三方库 -->
    <script type="module" src="lib/ethers-6.16.esm.min.js"></script>
    <script src="lib/qrcode.min.js"></script>

    <!-- 应用入口 -->
    <script type="module" src="js/app/popup.js"></script>
  </body>
</html>
